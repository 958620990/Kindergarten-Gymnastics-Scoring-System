<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幼儿园体操比赛评分系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #FF8E8E;
            --secondary: #5AA5C2;
            --accent: #FFD166;
            --light: #F7F9FC;
            --dark: #4A4A4A;
            --success: #8AC926;
            --purple: #C77DFF;
            --light-blue: #e6f7ff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle fill="%23FFD166" opacity="0.1" cx="20" cy="20" r="15"/><circle fill="%235AA5C2" opacity="0.1" cx="60" cy="40" r="12"/><circle fill="%23FF8E8E" opacity="0.1" cx="40" cy="70" r="10"/></svg>');
            background-size: 100px 100px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 登录界面样式 */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 90vh;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            border: 8px solid var(--accent);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .login-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 15px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent), var(--purple));
        }
        
        .login-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
            text-shadow: 2px 2px 0 rgba(0,0,0,0.05);
        }
        
        .login-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--dark);
        }
        
        .role-selection {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .role-btn {
            padding: 18px;
            border: 3px solid var(--secondary);
            border-radius: 15px;
            background: var(--secondary);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .role-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s;
        }
        
        .role-btn:hover::before {
            left: 100%;
        }
        
        .role-btn:hover {
            background: #4A95B2;
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .role-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .login-input {
            padding: 18px;
            border: 3px solid #ddd;
            border-radius: 15px;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        .login-input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(90, 165, 194, 0.3);
            outline: none;
        }
        
        .login-btn {
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), #FF6B6B);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 6px 0 #D94C4C;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .login-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s;
        }
        
        .login-btn:hover::before {
            left: 100%;
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #D94C4C;
        }
        
        .login-btn:active {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #D94C4C;
        }
        
        /* 主界面样式 */
        .main-container {
            display: none;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #FFA5A5);
            color: white;
            padding: 25px 0;
            text-align: center;
            border-radius: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(255, 142, 142, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 50px;
            backdrop-filter: blur(5px);
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .score-panel {
            background: white;
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 5px solid var(--accent);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .score-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent), var(--purple));
        }
        
        .score-panel h2 {
            margin-bottom: 20px;
            color: var(--dark);
            border-bottom: 3px dashed var(--primary);
            padding-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .class-management {
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .input-group input {
            flex: 1;
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 15px;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(90, 165, 194, 0.3);
            outline: none;
        }
        
        .input-group button {
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--secondary), #5AA5C2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 0 #4A95B2;
            white-space: nowrap;
        }
        
        .input-group button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 #4A95B2;
        }
        
        .input-group button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #4A95B2;
        }
        
        .class-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .class-button-wrapper {
            flex: 1;
            min-width: 120px;
            position: relative;
        }
        
        .class-button {
            padding: 15px;
            background: linear-gradient(135deg, var(--secondary), #5AA5C2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 0 #4A95B2;
            text-align: center;
            width: 100%;
        }
        
        .class-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 #4A95B2;
        }
        
        .class-button.active {
            background: linear-gradient(135deg, var(--primary), #FF6B6B);
            box-shadow: 0 5px 0 #D94C4C;
        }
        
        .class-button.active:hover {
            box-shadow: 0 7px 0 #D94C4C;
        }
        
        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF5252;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .delete-btn:hover {
            background: #FF0000;
            transform: scale(1.1);
        }
        
        .judge-scores {
            margin-top: 20px;
        }
        
        .judge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .judge-score-item {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid var(--secondary);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .judge-score-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .judge-name {
            font-weight: 600;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .score-input {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-input input {
            text-align: center;
            font-size: 1.2rem;
            padding: 12px;
            border: 3px solid #ddd;
            border-radius: 10px;
            width: 100%;
        }
        
        button {
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--secondary), #5AA5C2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            font-weight: bold;
            box-shadow: 0 5px 0 #4A95B2;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 #4A95B2;
        }
        
        button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #4A95B2;
        }
        
        button:disabled {
            background: var(--gray);
            box-shadow: 0 5px 0 #7A7E8F;
            cursor: not-allowed;
            transform: none;
        }
        
        .alert {
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
            font-size: 1.1rem;
        }
        
        .alert-success {
            background-color: rgba(138, 201, 38, 0.2);
            border-left: 5px solid var(--success);
            color: #155724;
        }
        
        .alert-danger {
            background-color: rgba(255, 107, 107, 0.2);
            border-left: 5px solid var(--primary);
            color: #721c24;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            font-size: 1rem;
        }
        
        th {
            background: linear-gradient(135deg, var(--primary), #FFA5A5);
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e9f7f6;
        }
        
        .rank-1 {
            background-color: rgba(255, 215, 0, 0.2) !important;
            font-weight: bold;
        }
        
        .rank-2 {
            background-color: rgba(192, 192, 192, 0.2) !important;
        }
        
        .rank-3 {
            background-color: rgba(205, 127, 50, 0.2) !important;
        }
        
        .medal {
            display: inline-block;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .gold {
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .silver {
            background: radial-gradient(circle at 30% 30%, #C0C0C0, #A0A0A0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .bronze {
            background: radial-gradient(circle at 30% 30%, #CD7F32, #A56C2C);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            font-size: 1rem;
            position: relative;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .score-circle {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent);
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .modify-button {
            background: linear-gradient(135deg, var(--primary), #FF6B6B);
            box-shadow: 0 5px 0 #D94C4C;
            margin-top: 5px;
        }
        
        .modify-button:hover {
            box-shadow: 0 7px 0 #D94C4C;
        }
        
        .modify-button:active {
            box-shadow: 0 3px 0 #D94C4C;
        }
        
        .instructions {
            background-color: rgba(255, 214, 102, 0.2);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid var(--accent);
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* 评委评分界面样式 */
        .judge-panel {
            display: none;
        }
        
        .batch-scoring {
            display: none;
        }
        
        .single-scoring {
            display: none;
        }
        
        .batch-classes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .batch-class-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 5px solid var(--accent);
            position: relative;
            overflow: hidden;
        }
        
        .batch-class-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        .class-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px dashed var(--secondary);
        }
        
        .class-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .class-order {
            background: var(--secondary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .batch-judge-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .batch-judge-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .batch-judge-input label {
            min-width: 80px;
            font-weight: bold;
        }
        
        .batch-judge-input input {
            flex: 1;
            padding: 10px;
            border: 3px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
        }
        
        .single-class-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 5px solid var(--accent);
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }
        
        .single-class-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        .progress-info {
            background: rgba(90, 165, 194, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 5px solid var(--secondary);
        }
        
        .completion-message {
            text-align: center;
            padding: 40px;
            background: rgba(255, 214, 102, 0.2);
            border-radius: 20px;
            margin-top: 30px;
            display: none;
        }
        
        /* 展示界面样式 */
        .display-panel {
            display: none;
        }
        
        .display-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .display-title {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.05);
        }
        
        .display-subtitle {
            font-size: 1.5rem;
            color: var(--dark);
        }
        
        .display-table {
            font-size: 1.3rem;
        }
        
        .display-table th, .display-table td {
            padding: 20px;
            font-size: 1.2rem;
        }
        
        .display-table th {
            font-size: 1.4rem;
        }
        
        .refresh-info {
            text-align: center;
            margin-top: 20px;
            font-size: 1.1rem;
            color: var(--gray);
        }
        
        /* 管理面板样式 */
        .admin-panel {
            display: none;
        }
        
        /* 打印按钮样式 */
        .print-btn {
            background: linear-gradient(135deg, var(--purple), #B56CE6);
            box-shadow: 0 5px 0 #9A4FC9;
            width: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .print-btn:hover {
            box-shadow: 0 7px 0 #9A4FC9;
        }
        
        .print-btn:active {
            box-shadow: 0 3px 0 #9A4FC9;
        }
        
        /* 评委评分汇总表格样式 */
        .judge-summary-table {
            width: 100%;
            margin: 20px 0;
            font-size: 1.2rem;
        }
        
        .judge-summary-table th {
            background: linear-gradient(135deg, var(--secondary), #5AA5C2);
        }
        
        .judge-summary-table tr:hover {
            background-color: #f0f8ff;
        }
        
        /* 打印样式 */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .printable, .printable * {
                visibility: visible;
            }
            
            .printable {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            
            .no-print {
                display: none !important;
            }
            
            table {
                box-shadow: none;
                border: 2px solid #333;
            }
            
            th {
                background: #f0f0f0 !important;
                color: #000 !important;
            }
            
            .medal {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            
            .print-signature-table {
                width: 100%;
                margin-top: 40px;
                border-collapse: collapse;
            }
            
            .print-signature-table td {
                border: 1px solid #333;
                padding: 15px;
                text-align: center;
                vertical-align: top;
            }
            
            .print-signature-table .label-cell {
                width: 25%;
                font-weight: bold;
            }
            
            .print-signature-table .signature-cell {
                width: 75%;
                height: 80px;
            }
        }
        
        .print-section {
            display: none;
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #333;
        }
        
        .print-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .print-subtitle {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        
        .print-signature-table {
            width: 100%;
            margin-top: 40px;
            border-collapse: collapse;
        }
        
        .print-signature-table td {
            border: 1px solid #333;
            padding: 15px;
            text-align: center;
            vertical-align: top;
        }
        
        .print-signature-table .label-cell {
            width: 25%;
            font-weight: bold;
        }
        
        .print-signature-table .signature-cell {
            width: 75%;
            height: 80px;
        }
        
        .user-management {
            margin-top: 20px;
        }
        
        .user-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        
        .user-info-display {
            display: flex;
            flex-direction: column;
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
        }
        
        .user-actions button {
            width: auto;
            padding: 8px 12px;
            font-size: 0.9rem;
            margin: 0;
        }
        
        .class-order-management {
            margin-top: 20px;
        }
        
        .class-order-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .class-order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
            cursor: move;
            transition: all 0.3s;
        }
        
        .class-order-item:hover {
            background: #f0f8ff;
            transform: translateY(-2px);
        }
        
        .class-order-item.dragging {
            opacity: 0.5;
            background: #e6f7ff;
        }
        
        .class-order-actions {
            display: flex;
            gap: 5px;
        }
        
        .class-order-actions button {
            width: auto;
            padding: 5px 10px;
            font-size: 0.8rem;
            margin: 0;
        }
        
        /* 评分编辑样式 */
        .editable-score {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .editable-score:hover {
            background-color: rgba(90, 165, 194, 0.1);
        }
        
        .editable-score.editing {
            background-color: rgba(255, 214, 102, 0.2);
        }
        
        .score-edit-input {
            width: 80px;
            padding: 5px;
            border: 2px solid var(--secondary);
            border-radius: 5px;
            text-align: center;
            font-size: 1rem;
        }
        
        .save-score-btn {
            background: linear-gradient(135deg, var(--success), #6BCF7F);
            box-shadow: 0 3px 0 #5ABF6F;
            width: auto;
            padding: 8px 15px;
            margin: 10px 0;
        }
        
        .save-score-btn:hover {
            box-shadow: 0 5px 0 #5ABF6F;
        }
        
        .decoration {
            position: absolute;
            width: 100px;
            height: 100px;
            opacity: 0.1;
            z-index: -1;
        }
        
        .decoration-1 {
            top: 10px;
            right: 10px;
            background: var(--primary);
            border-radius: 50%;
        }
        
        .decoration-2 {
            bottom: 10px;
            left: 10px;
            background: var(--secondary);
            border-radius: 50%;
        }
        
        .decoration-3 {
            top: 50%;
            left: 10px;
            background: var(--accent);
            width: 80px;
            height: 80px;
            border-radius: 20px;
            transform: rotate(45deg);
        }
        
        @media (max-width: 768px) {
            .judge-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .admin-login-btn {
                position: static;
                margin-top: 10px;
                width: auto;
                align-self: flex-end;
            }
            
            .batch-classes {
                grid-template-columns: 1fr;
            }
            
            .display-table {
                font-size: 1rem;
            }
            
            .display-table th, .display-table td {
                padding: 10px;
                font-size: 0.9rem;
            }
            
            .input-group {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .score-panel {
                padding: 15px;
            }
            
            th, td {
                padding: 8px 4px;
                font-size: 0.85rem;
            }
            
            .judge-grid {
                grid-template-columns: 1fr;
            }
            
            .class-buttons {
                flex-direction: column;
            }
            
            .class-button-wrapper {
                width: 100%;
            }
            
            .login-box {
                padding: 20px;
            }
            
            .login-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- 登录界面 -->
    <div class="login-container" id="login-container">
        <div class="login-box">
            <h1 class="login-title"><i class="fas fa-child"></i> 体操比赛评分</h1>
            <p class="login-subtitle">请选择角色并登录</p>
            
            <div class="role-selection">
                <button class="role-btn" data-role="admin">
                    <i class="fas fa-cog"></i> 管理员
                </button>
                <button class="role-btn" data-role="judge">
                    <i class="fas fa-user-tie"></i> 评委
                </button>
                <button class="role-btn" data-role="display">
                    <i class="fas fa-tv"></i> 展示界面
                </button>
            </div>
            
            <div class="login-form">
                <input type="text" class="login-input" id="username" placeholder="用户名">
                <input type="password" class="login-input" id="password" placeholder="密码">
                <button class="login-btn" id="login-btn">登录</button>
            </div>
            
            <div class="alert" id="login-alert"></div>
        </div>
    </div>

    <!-- 主界面 - 管理员 -->
    <div class="main-container" id="admin-panel">
        <header>
            <h1><i class="fas fa-child"></i> 幼儿园体操比赛评分系统</h1>
            <p class="subtitle">系统管理与设置</p>
            <div class="user-info">
                <span id="current-user">管理员</span>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>
        
        <div class="score-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-users"></i>
                    <h2>班级管理</h2>
                </div>
                <button class="print-btn no-print" id="admin-print-btn">
                    <i class="fas fa-print"></i> 打印成绩单
                </button>
            </div>
            
            <div class="input-group">
                <input type="text" id="new-class-input" placeholder="输入新班级名称">
                <button id="add-class-btn">
                    <i class="fas fa-plus"></i> 添加班级
                </button>
            </div>
            
            <div class="class-buttons" id="admin-class-buttons-container">
                <!-- 班级按钮将动态生成 -->
            </div>
        </div>
        
        <div class="score-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-user-tie"></i>
                    <h2>评委管理</h2>
                </div>
            </div>
            
            <div class="input-group">
                <input type="text" id="new-judge-input" placeholder="输入新评委用户名">
                <input type="password" id="new-judge-password" placeholder="设置密码">
                <button id="add-judge-btn">
                    <i class="fas fa-plus"></i> 添加评委
                </button>
            </div>
            
            <div class="user-management">
                <h3>评委账号列表</h3>
                <div class="user-list" id="judge-list-container">
                    <!-- 评委列表将动态生成 -->
                </div>
            </div>
        </div>
        
        <div class="score-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-list-ol"></i>
                    <h2>比赛顺序管理</h2>
                </div>
            </div>
            
            <p>设置班级比赛顺序（拖动调整顺序）</p>
            
            <div class="class-order-management">
                <div class="class-order-list" id="class-order-container">
                    <!-- 班级顺序列表将动态生成 -->
                </div>
            </div>
        </div>
        
        <div class="score-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-chart-bar"></i>
                    <h2>评分总览</h2>
                </div>
                <button class="save-score-btn" id="save-all-scores" style="display: none;">
                    <i class="fas fa-save"></i> 保存所有修改
                </button>
            </div>
            
            <table id="score-table">
                <thead id="score-header">
                    <!-- 表头将通过JavaScript动态生成 -->
                </thead>
                <tbody id="score-body">
                    <!-- 评分数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
        </div>
        
        <footer>
            <p>幼儿园体操比赛评分系统 © <span id="current-year"></span> - 活力体操，快乐无限！</p>
            <p>技术支持：杨凌高新幼儿园信息化中心</p>
        </footer>
    </div>

    <!-- 主界面 - 评委 -->
    <div class="main-container" id="judge-panel">
        <header>
            <h1><i class="fas fa-child"></i> 幼儿园体操比赛 - 评委评分</h1>
            <p class="subtitle">请按顺序为班级评分</p>
            <div class="user-info">
                <span id="judge-user">评委</span>
                <button class="logout-btn" id="judge-logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>
        
        <!-- 批量评分界面（前3个班） -->
        <div class="score-panel batch-scoring" id="batch-scoring-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-clipboard-list"></i>
                    <h2>批量评分</h2>
                </div>
            </div>
            
            <div class="progress-info">
                <p>请为以下3个班级评分，完成后一次性提交</p>
            </div>
            
            <div class="batch-classes" id="batch-classes-container">
                <!-- 批量评分班级卡片将动态生成 -->
            </div>
            
            <div class="action-buttons">
                <button id="submit-batch-scores">
                    <i class="fas fa-paper-plane"></i> 提交批量评分
                </button>
            </div>
        </div>
        
        <!-- 单个评分界面（后续班级） -->
        <div class="score-panel single-scoring" id="single-scoring-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <i class="fas fa-edit"></i>
                    <h2>单个评分</h2>
                </div>
            </div>
            
            <div class="progress-info" id="single-progress-info">
                <!-- 进度信息将动态生成 -->
            </div>
            
            <div class="single-class-card" id="single-class-card">
                <!-- 单个班级评分卡片将动态生成 -->
            </div>
            
            <div class="action-buttons">
                <button id="submit-single-score">
                    <i class="fas fa-paper-plane"></i> 提交评分并进入下一班
                </button>
            </div>
            
            <div class="completion-message" id="completion-message">
                <h2><i class="fas fa-check-circle"></i> 评分完成！</h2>
                <p>您已完成所有班级的评分，感谢您的参与！</p>
                <p>如有分数需要修改，请联系管理员。</p>
                
                <!-- 评委评分汇总表格 -->
                <div class="score-panel" style="margin-top: 30px;">
                    <div class="panel-header">
                        <div class="panel-title">
                            <i class="fas fa-list-alt"></i>
                            <h2>您的评分汇总</h2>
                        </div>
                    </div>
                    
                    <table class="judge-summary-table" id="judge-summary-table">
                        <thead>
                            <tr>
                                <th>班级名称</th>
                                <th>您的评分</th>
                            </tr>
                        </thead>
                        <tbody id="judge-summary-body">
                            <!-- 评委评分汇总将动态生成 -->
                        </tbody>
                    </table>
                </div>
                
                <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                    技术支持：杨凌高新幼儿园信息化中心
                </p>
            </div>
        </div>
    </div>

    <!-- 主界面 - 展示 -->
    <div class="main-container" id="display-panel">
        <header>
            <h1><i class="fas fa-child"></i> 幼儿园体操比赛</h1>
            <p class="subtitle">实时评分与排名展示</p>
            <div class="user-info">
                <span>展示模式</span>
                <button class="logout-btn" id="display-logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>
        
        <div class="score-panel">
            <div class="display-header">
                <h1 class="display-title">比赛实时排名</h1>
                <p class="display-subtitle">数据将自动更新</p>
            </div>
            
            <table class="display-table" id="display-score-table">
                <thead id="display-score-header">
                    <!-- 表头将通过JavaScript动态生成 -->
                </thead>
                <tbody id="display-score-body">
                    <!-- 评分数据将通过JavaScript动态生成 -->
                </tbody>
            </table>
            
            <div class="refresh-info">
                <p><i class="fas fa-sync-alt"></i> 数据每10秒自动刷新</p>
            </div>
        </div>
        
        <footer>
            <p>幼儿园体操比赛评分系统 © <span id="display-current-year"></span> - 活力体操，快乐无限！</p>
            <p>技术支持：杨凌高新幼儿园信息化中心</p>
        </footer>
    </div>

    <!-- 打印区域 -->
    <div class="print-section printable" id="print-section">
        <div class="print-header">
            <h1 class="print-title">幼儿园体操比赛成绩单</h1>
            <p class="print-subtitle">活力体操，快乐无限</p>
        </div>
        
        <table id="print-score-table">
            <thead id="print-score-header">
                <!-- 表头将通过JavaScript动态生成 -->
            </thead>
            <tbody id="print-score-body">
                <!-- 评分数据将通过JavaScript动态生成 -->
            </tbody>
        </table>
        
        <table class="print-signature-table">
            <tr>
                <td class="label-cell">评委小组签字</td>
                <td class="signature-cell"></td>
            </tr>
            <tr>
                <td class="label-cell">记分员签字</td>
                <td class="signature-cell"></td>
            </tr>
            <tr>
                <td class="label-cell">日期</td>
                <td class="signature-cell"></td>
            </tr>
        </table>
    </div>

    <script>
        // 初始化存储
        function initializeStorage() {
            if (!localStorage.getItem('gymnasticsClasses')) {
                localStorage.setItem('gymnasticsClasses', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('gymnasticsJudges')) {
                localStorage.setItem('gymnasticsJudges', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('gymnasticsScores')) {
                localStorage.setItem('gymnasticsScores', JSON.stringify({}));
            }
            
            if (!localStorage.getItem('gymnasticsUsers')) {
                // 初始化用户数据
                const defaultUsers = {
                    'admin': {
                        password: 'admin123',
                        role: 'admin'
                    },
                    'display': {
                        password: 'display123',
                        role: 'display'
                    }
                };
                localStorage.setItem('gymnasticsUsers', JSON.stringify(defaultUsers));
            }
            
            if (!localStorage.getItem('gymnasticsClassOrder')) {
                localStorage.setItem('gymnasticsClassOrder', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('gymnasticsJudgeProgress')) {
                localStorage.setItem('gymnasticsJudgeProgress', JSON.stringify({}));
            }
        }
        
        // 获取班级列表
        function getClasses() {
            return JSON.parse(localStorage.getItem('gymnasticsClasses'));
        }
        
        // 保存班级列表
        function saveClasses(classes) {
            localStorage.setItem('gymnasticsClasses', JSON.stringify(classes));
        }
        
        // 获取评委列表
        function getJudges() {
            return JSON.parse(localStorage.getItem('gymnasticsJudges'));
        }
        
        // 保存评委列表
        function saveJudges(judges) {
            localStorage.setItem('gymnasticsJudges', JSON.stringify(judges));
        }
        
        // 获取用户数据
        function getUsers() {
            return JSON.parse(localStorage.getItem('gymnasticsUsers'));
        }
        
        // 保存用户数据
        function saveUsers(users) {
            localStorage.setItem('gymnasticsUsers', JSON.stringify(users));
        }
        
        // 获取当前评分数据
        function getScores() {
            return JSON.parse(localStorage.getItem('gymnasticsScores'));
        }
        
        // 保存评分数据
        function saveScores(scores) {
            localStorage.setItem('gymnasticsScores', JSON.stringify(scores));
        }
        
        // 获取班级评分顺序
        function getClassOrder() {
            return JSON.parse(localStorage.getItem('gymnasticsClassOrder'));
        }
        
        // 保存班级评分顺序
        function saveClassOrder(order) {
            localStorage.setItem('gymnasticsClassOrder', JSON.stringify(order));
        }
        
        // 获取评委进度
        function getJudgeProgress() {
            return JSON.parse(localStorage.getItem('gymnasticsJudgeProgress'));
        }
        
        // 保存评委进度
        function saveJudgeProgress(progress) {
            localStorage.setItem('gymnasticsJudgeProgress', JSON.stringify(progress));
        }
        
        // 计算总分
        function calculateTotal(scores) {
            let total = 0;
            const judges = getJudges();
            judges.forEach(judge => {
                const score = scores[judge];
                if (score !== null && score !== undefined) {
                    total += score;
                }
            });
            return total;
        }
        
        // 计算平均分（去高去低）
        function calculateAverage(scores) {
            // 只考虑有分数的评委
            const judges = getJudges();
            const judgeScores = [];
            judges.forEach(judge => {
                const score = scores[judge];
                if (score !== null && score !== undefined) {
                    judgeScores.push(score);
                }
            });
            
            if (judgeScores.length === 0) return null;
            
            if (judgeScores.length <= 2) {
                // 如果只有两个或更少的分数，直接求平均
                return judgeScores.reduce((sum, score) => sum + score, 0) / judgeScores.length;
            }
            
            // 去高去低求平均
            const sortedScores = [...judgeScores].sort((a, b) => a - b);
            const trimmedScores = sortedScores.slice(1, -1); // 去掉最高和最低
            return trimmedScores.reduce((sum, score) => sum + score, 0) / trimmedScores.length;
        }
        
        // 显示提示信息
        function showAlert(message, type = 'success', containerId = 'login-alert') {
            const alert = document.getElementById(containerId);
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }
        
        // ID 清理函数
        function sanitizeId(name) {
            return name.replace(/\s+/g, '_').replace(/[^\w\-]/g, '');
        }
        
        // 渲染班级按钮
        function renderClassButtons() {
            const container = document.getElementById('admin-class-buttons-container');
            const classes = getClasses();
            
            container.innerHTML = '';
            
            classes.forEach(className => {
                const wrapper = document.createElement('div');
                wrapper.className = 'class-button-wrapper';
                
                const classButton = document.createElement('button');
                classButton.className = 'class-button';
                classButton.setAttribute('data-class', className);
                classButton.textContent = className;
                
                // 添加删除按钮
                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-btn';
                deleteButton.innerHTML = '<i class="fas fa-times"></i>';
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteClass(className);
                });
                
                wrapper.appendChild(classButton);
                wrapper.appendChild(deleteButton);
                container.appendChild(wrapper);
            });
        }
        
        // 渲染评委列表
        function renderJudgeList() {
            const container = document.getElementById('judge-list-container');
            const users = getUsers();
            const judges = getJudges();
            
            container.innerHTML = '';
            
            judges.forEach(judge => {
                if (users[judge] && users[judge].role === 'judge') {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div class="user-info-display">
                            <strong>${judge}</strong>
                            <span>评委账号</span>
                        </div>
                        <div class="user-actions">
                            <button class="danger-button delete-judge-btn" data-user="${judge}">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    `;
                    container.appendChild(userItem);
                }
            });
            
            // 添加删除评委事件
            document.querySelectorAll('.delete-judge-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const username = this.getAttribute('data-user');
                    deleteJudge(username);
                });
            });
        }
        
        // 渲染班级顺序列表
        function renderClassOrder() {
            const container = document.getElementById('class-order-container');
            const classOrder = getClassOrder();
            const classes = getClasses();
            
            container.innerHTML = '';
            
            // 如果还没有设置顺序，使用班级列表作为默认顺序
            const effectiveOrder = classOrder.length > 0 ? classOrder : classes;
            
            effectiveOrder.forEach((className, index) => {
                const orderItem = document.createElement('div');
                orderItem.className = 'class-order-item';
                orderItem.setAttribute('data-class', className);
                orderItem.setAttribute('draggable', 'true');
                orderItem.innerHTML = `
                    <div>
                        <span class="class-order">${index + 1}</span>
                        <strong>${className}</strong>
                    </div>
                    <div class="class-order-actions">
                        <button class="move-up-btn" data-class="${className}">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                        <button class="move-down-btn" data-class="${className}">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                        <button class="danger-button remove-order-btn" data-class="${className}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                container.appendChild(orderItem);
            });
            
            // 添加顺序调整事件
            document.querySelectorAll('.move-up-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    moveClassUp(className);
                });
            });
            
            document.querySelectorAll('.move-down-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    moveClassDown(className);
                });
            });
            
            document.querySelectorAll('.remove-order-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    removeClassFromOrder(className);
                });
            });
            
            // 添加拖动排序功能
            const orderItems = document.querySelectorAll('.class-order-item');
            orderItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }
        
        // 拖动排序功能
        let dragSrcElement = null;
        
        function handleDragStart(e) {
            dragSrcElement = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
            this.classList.add('dragging');
        }
        
        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }
        
        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (dragSrcElement !== this) {
                const classOrder = getClassOrder();
                const classes = getClasses();
                const effectiveOrder = classOrder.length > 0 ? classOrder : classes;
                
                const dragIndex = Array.from(this.parentNode.children).indexOf(dragSrcElement);
                const dropIndex = Array.from(this.parentNode.children).indexOf(this);
                
                // 交换位置
                [effectiveOrder[dragIndex], effectiveOrder[dropIndex]] = [effectiveOrder[dropIndex], effectiveOrder[dragIndex]];
                saveClassOrder(effectiveOrder);
                renderClassOrder();
            }
            
            return false;
        }
        
        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }
        
        // 渲染评分总览表格（管理员可编辑）
        function renderScoreTable() {
            const scoreHeader = document.getElementById('score-header');
            const scoreBody = document.getElementById('score-body');
            const scores = getScores();
            const classes = getClasses();
            const judges = getJudges();
            
            // 生成表头
            let headerHTML = '<tr><th>班级</th>';
            judges.forEach((judge, index) => {
                headerHTML += `<th>评委 ${index + 1}</th>`;
            });
            headerHTML += '<th>总分</th><th>平均分</th><th>排名</th></tr>';
            scoreHeader.innerHTML = headerHTML;
            
            // 计算每个班级的平均分和总分
            const classAverages = {};
            const classTotals = {};
            classes.forEach(className => {
                classAverages[className] = calculateAverage(scores[className] || {});
                classTotals[className] = calculateTotal(scores[className] || {});
            });
            
            // 按平均分排序
            const sortedClasses = [...classes].sort((a, b) => {
                const avgA = classAverages[a] || 0;
                const avgB = classAverages[b] || 0;
                return avgB - avgA;
            });
            
            scoreBody.innerHTML = '';
            
            sortedClasses.forEach((className, index) => {
                const row = document.createElement('tr');
                const average = classAverages[className];
                const total = classTotals[className];
                const rank = index + 1;
                
                // 设置排名样式
                if (rank === 1) row.className = 'rank-1';
                else if (rank === 2) row.className = 'rank-2';
                else if (rank === 3) row.className = 'rank-3';
                
                // 生成排名显示
                let rankDisplay = `${rank}`;
                if (rank <= 3) {
                    const medalClass = rank === 1 ? 'gold' : (rank === 2 ? 'silver' : 'bronze');
                    rankDisplay = `<span class="medal ${medalClass}"></span>${rank}`;
                }
                
                // 生成评委分数单元格
                let judgeCells = '';
                judges.forEach(judge => {
                    const score = (scores[className] && scores[className][judge]) !== undefined ? 
                                  scores[className][judge] : null;
                    judgeCells += `<td class="editable-score" data-class="${className}" data-judge="${judge}">${score !== null ? score : '-'}</td>`;
                });
                
                row.innerHTML = `
                    <td>${className}</td>
                    ${judgeCells}
                    <td>${total !== 0 ? total.toFixed(1) : '-'}</td>
                    <td>${average !== null ? average.toFixed(2) : '-'}</td>
                    <td>${rankDisplay}</td>
                `;
                
                scoreBody.appendChild(row);
            });
            
            // 添加编辑功能
            document.querySelectorAll('.editable-score').forEach(cell => {
                cell.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    const judge = this.getAttribute('data-judge');
                    const currentScore = this.textContent;
                    
                    // 如果是"-"，则设置为空
                    const currentValue = currentScore === '-' ? '' : currentScore;
                    
                    // 创建输入框
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = 0;
                    input.max = 100;
                    input.step = 0.1;
                    input.value = currentValue;
                    input.className = 'score-edit-input';
                    
                    // 替换单元格内容
                    this.innerHTML = '';
                    this.appendChild(input);
                    this.classList.add('editing');
                    
                    // 聚焦输入框
                    input.focus();
                    
                    // 保存按钮显示
                    document.getElementById('save-all-scores').style.display = 'block';
                    
                    // 输入框失去焦点时保存
                    input.addEventListener('blur', function() {
                        saveScoreEdit(className, judge, this.value, cell);
                    });
                    
                    // 按Enter键保存
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            saveScoreEdit(className, judge, this.value, cell);
                        }
                    });
                });
            });
        }
        
        // 保存分数编辑
        function saveScoreEdit(className, judge, value, cell) {
            const scores = getScores();
            
            if (!scores[className]) {
                scores[className] = {};
            }
            
            if (value === '') {
                scores[className][judge] = null;
                cell.textContent = '-';
            } else {
                const score = parseFloat(value);
                if (isNaN(score) || score < 0 || score > 100) {
                    showAlert('分数无效，请输入0-100之间的数字', 'danger');
                    // 恢复原来的值
                    const originalValue = scores[className][judge];
                    cell.textContent = originalValue !== null && originalValue !== undefined ? originalValue : '-';
                } else {
                    scores[className][judge] = score;
                    cell.textContent = score;
                }
            }
            
            cell.classList.remove('editing');
            saveScores(scores);
            
            // 重新计算并更新总分和平均分
            renderScoreTable();
        }
        
        // 渲染展示界面表格
        function renderDisplayTable() {
            const scoreHeader = document.getElementById('display-score-header');
            const scoreBody = document.getElementById('display-score-body');
            const scores = getScores();
            const classes = getClasses();
            const judges = getJudges();
            
            // 生成表头
            let headerHTML = '<tr><th>排名</th><th>班级</th>';
            judges.forEach((judge, index) => {
                headerHTML += `<th>评委 ${index + 1}</th>`;
            });
            headerHTML += '<th>总分</th><th>平均分</th></tr>';
            scoreHeader.innerHTML = headerHTML;
            
            // 计算每个班级的平均分和总分
            const classAverages = {};
            const classTotals = {};
            classes.forEach(className => {
                classAverages[className] = calculateAverage(scores[className] || {});
                classTotals[className] = calculateTotal(scores[className] || {});
            });
            
            // 按平均分排序
            const sortedClasses = [...classes].sort((a, b) => {
                const avgA = classAverages[a] || 0;
                const avgB = classAverages[b] || 0;
                return avgB - avgA;
            });
            
            scoreBody.innerHTML = '';
            
            sortedClasses.forEach((className, index) => {
                const row = document.createElement('tr');
                const average = classAverages[className];
                const total = classTotals[className];
                const rank = index + 1;
                
                // 设置排名样式
                if (rank === 1) row.className = 'rank-1';
                else if (rank === 2) row.className = 'rank-2';
                else if (rank === 3) row.className = 'rank-3';
                
                // 生成排名显示
                let rankDisplay = `${rank}`;
                if (rank <= 3) {
                    const medalClass = rank === 1 ? 'gold' : (rank === 2 ? 'silver' : 'bronze');
                    rankDisplay = `<span class="medal ${medalClass}"></span> ${rank}`;
                }
                
                // 生成评委分数单元格
                let judgeCells = '';
                judges.forEach(judge => {
                    const score = (scores[className] && scores[className][judge]) !== undefined ? 
                                  scores[className][judge] : null;
                    judgeCells += `<td>${score !== null ? score : '-'}</td>`;
                });
                
                row.innerHTML = `
                    <td><strong>${rankDisplay}</strong></td>
                    <td><strong>${className}</strong></td>
                    ${judgeCells}
                    <td><strong>${total !== 0 ? total.toFixed(1) : '-'}</strong></td>
                    <td><strong>${average !== null ? average.toFixed(2) : '-'}</strong></td>
                `;
                
                scoreBody.appendChild(row);
            });
        }
        
        // 渲染打印表格
        function renderPrintTable() {
            const scoreHeader = document.getElementById('print-score-header');
            const scoreBody = document.getElementById('print-score-body');
            const scores = getScores();
            const classes = getClasses();
            const judges = getJudges();
            
            // 生成表头
            let headerHTML = '<tr><th>排名</th><th>班级</th>';
            judges.forEach((judge, index) => {
                headerHTML += `<th>评委 ${index + 1}</th>`;
            });
            headerHTML += '<th>总分</th><th>平均分</th></tr>';
            scoreHeader.innerHTML = headerHTML;
            
            // 计算每个班级的平均分和总分
            const classAverages = {};
            const classTotals = {};
            classes.forEach(className => {
                classAverages[className] = calculateAverage(scores[className] || {});
                classTotals[className] = calculateTotal(scores[className] || {});
            });
            
            // 按平均分排序
            const sortedClasses = [...classes].sort((a, b) => {
                const avgA = classAverages[a] || 0;
                const avgB = classAverages[b] || 0;
                return avgB - avgA;
            });
            
            scoreBody.innerHTML = '';
            
            sortedClasses.forEach((className, index) => {
                const row = document.createElement('tr');
                const average = classAverages[className];
                const total = classTotals[className];
                const rank = index + 1;
                
                // 生成排名显示
                let rankDisplay = `${rank}`;
                if (rank <= 3) {
                    const medalClass = rank === 1 ? 'gold' : (rank === 2 ? 'silver' : 'bronze');
                    rankDisplay = `<span class="medal ${medalClass}"></span> ${rank}`;
                }
                
                // 生成评委分数单元格
                let judgeCells = '';
                judges.forEach(judge => {
                    const score = (scores[className] && scores[className][judge]) !== undefined ? 
                                  scores[className][judge] : null;
                    judgeCells += `<td>${score !== null ? score : '-'}</td>`;
                });
                
                row.innerHTML = `
                    <td><strong>${rankDisplay}</strong></td>
                    <td><strong>${className}</strong></td>
                    ${judgeCells}
                    <td><strong>${total !== 0 ? total.toFixed(1) : '-'}</strong></td>
                    <td><strong>${average !== null ? average.toFixed(2) : '-'}</strong></td>
                `;
                
                scoreBody.appendChild(row);
            });
        }
        
        // 渲染评委评分界面
        function renderJudgeScoringInterface(username) {
            const classOrder = getClassOrder();
            const classes = getClasses();
            const judgeProgress = getJudgeProgress();
            const userProgress = judgeProgress[username] || { currentIndex: 0 };
            
            // 如果没有设置顺序，使用班级列表
            const effectiveOrder = classOrder.length > 0 ? classOrder : classes;
            
            // 检查是否所有班级都已评分
            if (userProgress.currentIndex >= effectiveOrder.length) {
                document.getElementById('batch-scoring-panel').style.display = 'none';
                document.getElementById('single-scoring-panel').style.display = 'block';
                document.getElementById('single-class-card').style.display = 'none';
                document.getElementById('completion-message').style.display = 'block';
                
                // 渲染评委评分汇总
                renderJudgeSummary(username);
                return;
            }
            
            // 批量评分阶段（前3个班）
            if (userProgress.currentIndex < 3 && effectiveOrder.length >= 3) {
                document.getElementById('batch-scoring-panel').style.display = 'block';
                document.getElementById('single-scoring-panel').style.display = 'none';
                
                const batchContainer = document.getElementById('batch-classes-container');
                batchContainer.innerHTML = '';
                
                // 获取前3个班级
                const batchClasses = effectiveOrder.slice(0, 3);
                
                batchClasses.forEach((className, index) => {
                    const classCard = document.createElement('div');
                    classCard.className = 'batch-class-card';
                    classCard.innerHTML = `
                        <div class="class-card-header">
                            <div class="class-name">${className}</div>
                            <div class="class-order">${index + 1}</div>
                        </div>
                        <div class="batch-judge-inputs">
                            <div class="batch-judge-input">
                                <label>评分:</label>
                                <input type="number" min="0" max="100" step="0.1" 
                                       placeholder="0-100分" 
                                       id="batch-score-${sanitizeId(className)}"
                                       class="batch-score-input">
                            </div>
                        </div>
                    `;
                    batchContainer.appendChild(classCard);
                });
            } 
            // 单个评分阶段（后续班级）
            else {
                document.getElementById('batch-scoring-panel').style.display = 'none';
                document.getElementById('single-scoring-panel').style.display = 'block';
                document.getElementById('completion-message').style.display = 'none';
                
                const currentClass = effectiveOrder[userProgress.currentIndex];
                const progressInfo = document.getElementById('single-progress-info');
                const singleCard = document.getElementById('single-class-card');
                
                progressInfo.innerHTML = `
                    <p>当前评分班级: <strong>${currentClass}</strong></p>
                    <p>进度: ${userProgress.currentIndex + 1} / ${effectiveOrder.length}</p>
                `;
                
                singleCard.innerHTML = `
                    <div class="class-card-header">
                        <div class="class-name">${currentClass}</div>
                        <div class="class-order">${userProgress.currentIndex + 1}</div>
                    </div>
                    <div class="batch-judge-inputs">
                        <div class="batch-judge-input">
                            <label>评分:</label>
                            <input type="number" min="0" max="100" step="0.1" 
                                   placeholder="0-100分" 
                                   id="single-score-${sanitizeId(currentClass)}"
                                   class="single-score-input">
                        </div>
                    </div>
                `;
                
                singleCard.style.display = 'block';
            }
        }
        
        // 渲染评委评分汇总
        function renderJudgeSummary(username) {
            const scores = getScores();
            const classOrder = getClassOrder();
            const classes = getClasses();
            
            // 如果没有设置顺序，使用班级列表
            const effectiveOrder = classOrder.length > 0 ? classOrder : classes;
            
            const summaryBody = document.getElementById('judge-summary-body');
            summaryBody.innerHTML = '';
            
            // 计算该评委已评分的班级
            const scoredClasses = effectiveOrder.filter(className => {
                return scores[className] && scores[className][username] !== undefined && scores[className][username] !== null;
            });
            
            if (scoredClasses.length === 0) {
                summaryBody.innerHTML = '<tr><td colspan="2" style="text-align: center;">您还没有为任何班级评分。</td></tr>';
                return;
            }
            
            // 按评分顺序显示班级和分数
            scoredClasses.forEach((className, index) => {
                const row = document.createElement('tr');
                const score = scores[className][username];
                
                row.innerHTML = `
                    <td>${index + 1}. ${className}</td>
                    <td><strong>${score}</strong> 分</td>
                `;
                
                summaryBody.appendChild(row);
            });
        }
        
        // 添加班级
        function addClass(className) {
            if (!className || className.trim() === '') {
                showAlert('请输入班级名称', 'danger');
                return;
            }
            
            const classes = getClasses();
            
            // 检查是否已存在
            if (classes.includes(className)) {
                showAlert('该班级已存在', 'danger');
                return;
            }
            
            // 添加到班级列表
            classes.push(className);
            saveClasses(classes);
            
            // 更新班级顺序
            const classOrder = getClassOrder();
            if (classOrder.length === 0) {
                classOrder.push(className);
                saveClassOrder(classOrder);
            }
            
            // 重新渲染相关组件
            renderClassButtons();
            renderClassOrder();
            renderScoreTable();
            
            // 清空输入框
            document.getElementById('new-class-input').value = '';
            
            showAlert(`成功添加班级: ${className}`, 'success');
        }
        
        // 删除班级
        function deleteClass(className) {
            if (confirm(`确定要删除班级 "${className}" 吗？此操作将同时删除该班级的所有评分数据！`)) {
                const classes = getClasses();
                
                // 从班级列表中移除
                const index = classes.indexOf(className);
                if (index > -1) {
                    classes.splice(index, 1);
                    saveClasses(classes);
                }
                
                // 从评分数据中移除
                const scores = getScores();
                delete scores[className];
                saveScores(scores);
                
                // 从班级顺序中移除
                const classOrder = getClassOrder();
                const orderIndex = classOrder.indexOf(className);
                if (orderIndex > -1) {
                    classOrder.splice(orderIndex, 1);
                    saveClassOrder(classOrder);
                }
                
                // 重新渲染相关组件
                renderClassButtons();
                renderClassOrder();
                renderScoreTable();
                
                showAlert(`成功删除班级: ${className}`, 'success');
            }
        }
        
        // 添加评委
        function addJudge(username, password) {
            if (!username || username.trim() === '') {
                showAlert('请输入评委用户名', 'danger');
                return;
            }
            
            if (!password || password.trim() === '') {
                showAlert('请输入评委密码', 'danger');
                return;
            }
            
            const users = getUsers();
            const judges = getJudges();
            
            // 检查是否已存在
            if (users[username]) {
                showAlert('该用户名已存在', 'danger');
                return;
            }
            
            // 添加到用户数据和评委列表
            users[username] = {
                password: password,
                role: 'judge'
            };
            judges.push(username);
            
            saveUsers(users);
            saveJudges(judges);
            
            // 初始化评委进度
            const judgeProgress = getJudgeProgress();
            judgeProgress[username] = { currentIndex: 0 };
            saveJudgeProgress(judgeProgress);
            
            // 重新渲染评委列表
            renderJudgeList();
            
            // 清空输入框
            document.getElementById('new-judge-input').value = '';
            document.getElementById('new-judge-password').value = '';
            
            showAlert(`成功添加评委: ${username}`, 'success');
        }
        
        // 删除评委
        function deleteJudge(username) {
            if (confirm(`确定要删除评委 "${username}" 吗？此操作将同时删除该评委在所有班级的评分数据！`)) {
                const users = getUsers();
                const judges = getJudges();
                const judgeProgress = getJudgeProgress();
                
                // 从用户数据和评委列表中移除
                delete users[username];
                const index = judges.indexOf(username);
                if (index > -1) {
                    judges.splice(index, 1);
                }
                delete judgeProgress[username];
                
                saveUsers(users);
                saveJudges(judges);
                saveJudgeProgress(judgeProgress);
                
                // 从评分数据中移除该评委的评分
                const scores = getScores();
                const classes = getClasses();
                classes.forEach(className => {
                    if (scores[className] && scores[className][username] !== undefined) {
                        delete scores[className][username];
                    }
                });
                saveScores(scores);
                
                // 重新渲染评委列表和评分表格
                renderJudgeList();
                renderScoreTable();
                
                showAlert(`成功删除评委: ${username}`, 'success');
            }
        }
        
        // 上移班级顺序
        function moveClassUp(className) {
            const classOrder = getClassOrder();
            const index = classOrder.indexOf(className);
            
            if (index > 0) {
                // 交换位置
                [classOrder[index], classOrder[index - 1]] = [classOrder[index - 1], classOrder[index]];
                saveClassOrder(classOrder);
                renderClassOrder();
            }
        }
        
        // 下移班级顺序
        function moveClassDown(className) {
            const classOrder = getClassOrder();
            const index = classOrder.indexOf(className);
            
            if (index < classOrder.length - 1) {
                // 交换位置
                [classOrder[index], classOrder[index + 1]] = [classOrder[index + 1], classOrder[index]];
                saveClassOrder(classOrder);
                renderClassOrder();
            }
        }
        
        // 从顺序中移除班级
        function removeClassFromOrder(className) {
            const classOrder = getClassOrder();
            const index = classOrder.indexOf(className);
            
            if (index > -1) {
                classOrder.splice(index, 1);
                saveClassOrder(classOrder);
                renderClassOrder();
                showAlert(`已将 ${className} 从评分顺序中移除`, 'success');
            }
        }
        
        // 提交批量评分
        function submitBatchScores(username) {
            const classOrder = getClassOrder();
            const classes = getClasses();
            const effectiveOrder = classOrder.length > 0 ? classOrder : classes;
            const batchClasses = effectiveOrder.slice(0, 3);
            const scores = getScores();
            let hasError = false;
            
            // 验证并收集分数
            batchClasses.forEach(className => {
                const scoreInput = document.getElementById(`batch-score-${sanitizeId(className)}`);
                const scoreValue = scoreInput.value.trim();
                
                if (scoreValue === '') {
                    showAlert(`请为 ${className} 输入分数`, 'danger');
                    hasError = true;
                    return;
                }
                
                const score = parseFloat(scoreValue);
                
                if (isNaN(score) || score < 0 || score > 100) {
                    showAlert(`${className} 的分数无效，请输入0-100之间的数字`, 'danger');
                    hasError = true;
                    return;
                }
                
                // 保存分数
                if (!scores[className]) {
                    scores[className] = {};
                }
                scores[className][username] = score;
            });
            
            if (hasError) return;
            
            // 保存评分数据
            saveScores(scores);
            
            // 更新评委进度
            const judgeProgress = getJudgeProgress();
            if (!judgeProgress[username]) judgeProgress[username] = { currentIndex: 0 };
            judgeProgress[username].currentIndex = 3;
            saveJudgeProgress(judgeProgress);
            
            // 重新渲染评分界面
            renderJudgeScoringInterface(username);
            
            showAlert('批量评分提交成功！', 'success');
        }
        
        // 提交单个评分
        function submitSingleScore(username) {
            const classOrder = getClassOrder();
            const classes = getClasses();
            const effectiveOrder = classOrder.length > 0 ? classOrder : classes;
            const judgeProgress = getJudgeProgress();
            if (!judgeProgress[username]) judgeProgress[username] = { currentIndex: 0 };
            const currentIndex = judgeProgress[username].currentIndex;
            const currentClass = effectiveOrder[currentIndex];
            const scores = getScores();
            
            const scoreInput = document.getElementById(`single-score-${sanitizeId(currentClass)}`);
            const scoreValue = scoreInput.value.trim();
            
            if (scoreValue === '') {
                showAlert(`请为 ${currentClass} 输入分数`, 'danger');
                return;
            }
            
            const score = parseFloat(scoreValue);
            
            if (isNaN(score) || score < 0 || score > 100) {
                showAlert(`分数无效，请输入0-100之间的数字`, 'danger');
                return;
            }
            
            // 保存分数
            if (!scores[currentClass]) {
                scores[currentClass] = {};
            }
            scores[currentClass][username] = score;
            saveScores(scores);
            
            // 更新评委进度
            judgeProgress[username].currentIndex = currentIndex + 1;
            saveJudgeProgress(judgeProgress);
            
            // 重新渲染评分界面
            renderJudgeScoringInterface(username);
            
            showAlert(`已为 ${currentClass} 提交评分`, 'success');
        }
        
        // 用户登录
        function loginUser(role, username, password) {
            const users = getUsers();
            
            // 验证用户
            if (!users[username] || users[username].password !== password || users[username].role !== role) {
                showAlert('用户名或密码错误', 'danger');
                return false;
            }
            
            // 保存当前用户信息
            sessionStorage.setItem('currentUser', JSON.stringify({
                username: username,
                role: role
            }));
            
            // 显示对应界面
            document.getElementById('login-container').style.display = 'none';
            
            if (role === 'admin') {
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('current-user').textContent = username;
                
                // 初始化管理员界面
                renderClassButtons();
                renderJudgeList();
                renderClassOrder();
                renderScoreTable();
            } else if (role === 'judge') {
                document.getElementById('judge-panel').style.display = 'block';
                document.getElementById('judge-user').textContent = username;
                
                // 初始化评委界面
                renderJudgeScoringInterface(username);
            } else if (role === 'display') {
                document.getElementById('display-panel').style.display = 'block';
                
                // 初始化展示界面
                renderDisplayTable();
                
                // 设置自动刷新
                setInterval(() => {
                    renderDisplayTable();
                }, 10000); // 每10秒刷新一次
            }
            
            return true;
        }
        
        // 用户登出
        function logoutUser() {
            sessionStorage.removeItem('currentUser');
            
            // 隐藏所有主界面，显示登录界面
            document.querySelectorAll('.main-container').forEach(container => {
                container.style.display = 'none';
            });
            document.getElementById('login-container').style.display = 'flex';
            
            // 清空登录表单
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // 打印成绩单
        function printScoreTable() {
            // 渲染打印表格
            renderPrintTable();
            
            // 显示打印区域
            document.getElementById('print-section').style.display = 'block';
            
            // 设置打印后回调
            window.onafterprint = () => {
                document.getElementById('print-section').style.display = 'none';
                window.onafterprint = null;
            };
            
            // 打印
            window.print();
        }
        
        // 更新当前年份
        function updateCurrentYear() {
            const currentYear = new Date().getFullYear();
            document.getElementById('current-year').textContent = currentYear;
            document.getElementById('display-current-year').textContent = currentYear;
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化存储
            initializeStorage();
            
            // 更新当前年份
            updateCurrentYear();
            
            // 检查是否已登录
            const currentUser = sessionStorage.getItem('currentUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                // 直接展示界面而不重复检查密码
                document.getElementById('login-container').style.display = 'none';
                if (user.role === 'admin') {
                    document.getElementById('admin-panel').style.display = 'block';
                    document.getElementById('current-user').textContent = user.username;
                    renderClassButtons(); 
                    renderJudgeList(); 
                    renderClassOrder(); 
                    renderScoreTable();
                } else if (user.role === 'judge') {
                    document.getElementById('judge-panel').style.display = 'block';
                    document.getElementById('judge-user').textContent = user.username;
                    renderJudgeScoringInterface(user.username);
                } else if (user.role === 'display') {
                    document.getElementById('display-panel').style.display = 'block';
                    renderDisplayTable();
                    setInterval(renderDisplayTable, 10000);
                }
            }
            
            // 角色选择事件
            document.querySelectorAll('.role-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有按钮的active类
                    document.querySelectorAll('.role-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // 为当前点击的按钮添加active类
                    this.classList.add('active');
                });
            });
            
            // 登录按钮事件
            document.getElementById('login-btn').addEventListener('click', function() {
                const activeRole = document.querySelector('.role-btn.active');
                if (!activeRole) {
                    showAlert('请选择角色', 'danger');
                    return;
                }
                
                const role = activeRole.getAttribute('data-role');
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                
                if (!username || !password) {
                    showAlert('请输入用户名和密码', 'danger');
                    return;
                }
                
                loginUser(role, username, password);
            });
            
            // 按Enter键登录
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('login-btn').click();
                }
            });
            
            // 登出按钮事件
            document.getElementById('logout-btn').addEventListener('click', logoutUser);
            document.getElementById('judge-logout-btn').addEventListener('click', logoutUser);
            document.getElementById('display-logout-btn').addEventListener('click', logoutUser);
            
            // 管理员功能事件
            document.getElementById('add-class-btn').addEventListener('click', function() {
                const className = document.getElementById('new-class-input').value.trim();
                addClass(className);
            });
            
            document.getElementById('add-judge-btn').addEventListener('click', function() {
                const username = document.getElementById('new-judge-input').value.trim();
                const password = document.getElementById('new-judge-password').value;
                addJudge(username, password);
            });
            
            // 打印按钮事件
            document.getElementById('admin-print-btn').addEventListener('click', printScoreTable);
            
            // 评委功能事件
            document.getElementById('submit-batch-scores').addEventListener('click', function() {
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (currentUser && currentUser.role === 'judge') {
                    submitBatchScores(currentUser.username);
                }
            });
            
            document.getElementById('submit-single-score').addEventListener('click', function() {
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (currentUser && currentUser.role === 'judge') {
                    submitSingleScore(currentUser.username);
                }
            });
        });
    </script>
</body>
</html>